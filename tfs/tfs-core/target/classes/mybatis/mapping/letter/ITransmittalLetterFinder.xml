<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ucpb.tfs.application.query.letter.ITransmittalLetterFinder">

    <select id="findAllTransmittalLetter" resultType="hashMap">
        select id,
         transmittalLetterCode,
         cast(letterDescription as varchar(3000)) as letterDescription
         from RefTransmittalLetter order by id asc
    </select>

    <select id="findAllSavedTransmittalLetter" resultType="hashMap">
        select transmittalLetterCode from TransmittalLetter where tradeServiceId = #{tradeServiceId} and letterType = 'DEFAULT' order by sequenceNumber asc
    </select>

    <select id="findAllDefaultTransmittalLetter" resultType="hashMap">
        select
          tl.transmittalLetterCode,
          cast(tl.letterDescription as varchar(3000)) as letterDescription,
          tl.originalCopy,
          tl.duplicateCopy

        from
          TransmittalLetter tl
        where
          tl.tradeServiceId = #{tradeServiceId}
        and
          tl.letterType = 'DEFAULT'

        union

        select
          rtl.transmittalLetterCode,
          cast(rtl.letterDescription as varchar(3000)) as letterDescription,
          '0' as originalCopy,
          '0' as duplicateCopy

        from
          RefTransmittalLetter rtl
        where
          rtl.transmittalLetterCode not in(select
                                              transmittalLetterCode

                                           from
                                              TransmittalLetter
                                           where
                                              tradeServiceId = #{tradeServiceId}
                                           and
                                              letterType = 'DEFAULT')
    </select>

    <select id="findAllNewTransmittalLetter" resultType="hashMap">
        select
          id,
          cast(letterDescription as varchar(3000)) as letterDescription,
          originalCopy,
          duplicateCopy
        from
          TransmittalLetter
        where
          tradeServiceId = #{tradeServiceId}
        and
          letterType = 'NEW'
          order by sequenceNumber asc
    </select>

</mapper>
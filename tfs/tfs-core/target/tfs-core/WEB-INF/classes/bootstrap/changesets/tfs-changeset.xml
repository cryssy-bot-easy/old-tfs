<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

    <changeSet id="create-job-history-table" author="robbie">
        <sql>
            CREATE TABLE JOB_HISTORY (ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1), JOB_NAME varchar(255),  TRIGGER_NAME varchar(255), GROUP_NAME varchar(255), START_TIME timestamp, END_TIME timestamp, PREVIOUS_FIRE_TIME timestamp, NEXT_FIRE_TIME timestamp, STATUS varchar(20), MESSAGE VARCHAR(1000));
        </sql>
    </changeSet>

    <changeSet id="create-ets-sequence" author="robbie">
        <createSequence sequenceName="ETS_NUM_SEQUENCE" startValue="1" incrementBy="1" maxValue="99999" cycle="true"/>
        <rollback>
            <sql>
                drop sequence ETS_NUM_SEQUENCE RESTRICT
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="create-trade-service-num-sequence" author="robbie">
        <createSequence sequenceName="TRADE_SERVICE_REF_NUM_SEQUENCE" startValue="1" incrementBy="1" maxValue="99999" cycle="true"/>
        <rollback>
            <sql>
                drop sequence TRADE_SERVICE_REF_NUM_SEQUENCE RESTRICT
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="create-token-table" author="robbie">
        <createTable tableName="TOKENS">
            <column name="TOKEN" type="bigint"/>
            <column name="ID" type="varchar(255)"/>
        </createTable>
    </changeSet>

    <changeSet id="create-loan-sequence-table" author="robbie">
        <createTable tableName="LOANSEQUENCE">
            <column name="SEQUENCE" type="bigint"/>
            <column name="DATE_INITIALIZED" type="timestamp"/>
        </createTable>
    </changeSet>
    
    <!--<changeSet id="updateJobHistoryTableMessageColumn" author="robbie">-->
        <!--&lt;!&ndash;<modifyDataType tableName="JOB_HISTORY" columnName="MESSAGE" newDataType="clob(2000)"/>&ndash;&gt;-->
        <!--<sql>-->
            <!--ALTER TABLE JOB_HISTORY ADD COLUMN TEMP_MESSAGE CLOB(3000);-->
            <!--UPDATE JOB_HISTORY SET TEMP_MESSAGE=MESSAGE;-->
            <!--ALTER TABLE JOB_HISTORY DROP COLUMN MESSAGE;-->
            <!--RENAME COLUMN JOB_HISTORY.TEMP_MESSAGE TO MESSAGE;-->
        <!--</sql>-->
    <!--</changeSet>-->


    <changeSet id="create-mt-message-sequence" author="robbie">
        <sql>
            CREATE SEQUENCE MT_MESSAGE_SEQUENCE START WITH 1 INCREMENT BY 1 NO MAXVALUE MINVALUE 00001 CYCLE
        </sql>
    </changeSet>

    <changeSet id="create-facility-balance-sequence" author="robbie">
        <sql>
            CREATE SEQUENCE FACILITY_BALANCE_QUERY_SEQUENCE START WITH 1 INCREMENT BY 1 NO MAXVALUE MINVALUE 00001 CYCLE
        </sql>
    </changeSet>

    <changeSet id="drop-loan-sequence-table" author="robbie">
        <dropTable tableName="LOANSEQUENCE"/>
    </changeSet>

    <changeSet id="create-generic-sibs-sequence-table" author="robbie">
        <createTable tableName="SIBS_SEQUENCES">
            <column name="SEQUENCE" type="bigint"/>
            <column name="DATE_INITIALIZED" type="timestamp"/>
            <column name="SEQUENCE_TYPE" type="varchar(10)"/>
        </createTable>
    </changeSet>

    <changeSet id="insert-sequence-data" author="robbie">
        <sql>
            INSERT INTO SIBS_SEQUENCES (SEQUENCE,DATE_INITIALIZED,SEQUENCE_TYPE) VALUES (1,CURRENT_TIMESTAMP,'LOAN');
            INSERT INTO SIBS_SEQUENCES (SEQUENCE,DATE_INITIALIZED,SEQUENCE_TYPE) VALUES (1,CURRENT_TIMESTAMP,'BALANCE');
        </sql>
        <rollback>
            DELETE FROM SIBS_SEQUENCES WHERE SEQUENCE_TYPE = 'LOAN' OR SEQUENCE_TYPE = 'BALANCE'
        </rollback>
    </changeSet>

    <changeSet id="create-daily-balance-table" author="robbie">
        <sql>
            CREATE TABLE "DAILYBALANCE"
            (
                ID bigint PRIMARY KEY NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
                DOCUMENTNUMBER varchar(30),
                BALANCE bigint,
                BALANCEDATE timestamp
            )
        </sql>
        <rollback>
            DROP TABLE DAILYBALANCE
        </rollback>
    </changeSet>

</databaseChangeLog>
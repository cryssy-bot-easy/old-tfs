<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:int="http://www.springframework.org/schema/integration"
    xmlns:int-jdbc="http://www.springframework.org/schema/integration/jdbc"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
	http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration.xsd
	http://www.springframework.org/schema/integration/jdbc http://www.springframework.org/schema/integration/jdbc/spring-integration-jdbc-2.0.xsd">

	<int:channel id="outputChannel"/>

	<int-jdbc:inbound-channel-adapter channel="outputChannel" id="dailyBalanceQuery" 
		query="SELECT OUTSTANDINGBALANCE, DATECLOSED, PROCESSDATE 
			FROM TFS.LETTEROFCREDIT LC
			INNER JOIN
				TFS.TRADEPRODUCT TP 
				ON TP.DOCUMENTNUMBER = LC.DOCUMENTNUMBER 
			WHERE TP.STATUS = 'ACTIVE' OR 
			(YEAR(LC.DATECLOSED) = YEAR(CURRENT_TIMESTAMP) AND MONTH(LC.DATECLOSED) = MONTH(CURRENT_TIMESTAMP))"
			row-mapper="resultMapper">
	
	</int-jdbc:inbound-channel-adapter>

	<bean id="resultMapper" class="com.ucpb.tfs.batch.util.BeanRowMapper">
		<constructor-arg name="beanClass" value="com.ucpb.tfs.batch.report.dw.Product"/>
		<constructor-arg name="mappings">
			<map>
				<entry key="documentNumber" value="DOCUMENTNUMBER"/>
				<entry key="outstandingBalance" value="OUTSTANDINGBALANCE"/>
				<entry key="entryDate" value="PROCESSDATE"/>
				<entry key="status" value="STATUS"/>
			</map>
		</constructor-arg>
	</bean>



</beans>
